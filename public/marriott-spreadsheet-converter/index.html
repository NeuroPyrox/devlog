<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Marriott Spreadsheet Converter</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#164113" />
    <meta name="msapplication-TileColor" content="#006600" />
    <meta name="theme-color" content="#006600" />
  </head>
  <body>
    Copy/paste from FOSSE:
    <br />
    <textarea></textarea>
    <br />
    Copy/paste to Excel:
    <br />
    <textarea></textarea>
  </body>
  <script type="module">
    import { just, nothing } from "./maybe.js";
    import * as P from "./parsers.js";

    const digit = P.charClass((char) => "0" <= char && char <= "9");
    const notDigit = P.charClass((char) => char < "0" || "9" < char);

    const month = Object.entries({
      Jan: 1,
      Feb: 2,
      Mar: 3,
      Apr: 4,
      May: 5,
      Jun: 6,
      Jul: 7,
      Aug: 8,
      Sep: 9,
      Oct: 10,
      Nov: 11,
      Dec: 12,
    }).reduce(
      (total, [key, value]) => total.or(P.string(key).map(() => value)),
      P.fail
    );

    const twoDigitNumber = digit
      .map((tens) => (ones) => parseInt(tens + ones))
      .apply(digit);

    const maxDaysPerMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

    const date = twoDigitNumber.chain((day) =>
      month.chain((month) =>
        twoDigitNumber.chain((year) =>
          maxDaysPerMonth[month - 1] < day ||
          (day === 29 && month === 4 && (year % 4 !== 0 || year === 0))
            ? P.fail
            : { day, month, year }
        )
      )
    );

    const integer = P.many1(digit).map((array) => parseInt(array.join("")));

    const mbv = P.repeat(digit, 9);

    const confo = P.repeat(digit, 8);

    const name = undefined;

    const folio = P.repeat(digit, 5);

    const arrive = date;

    const depart = date;

    const t = P.string("R").or(P.string("D"));

    const cert = P.repeat(digit, 8);

    const n = integer;

    const amount = P.constant(0)
      .or(integer.filter((i) => i % 30 === 0))
      .skipRight(P.string(".00"));

    const row = undefined;
  </script>
</html>
